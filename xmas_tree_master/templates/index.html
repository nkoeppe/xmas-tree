<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D LED Visualizer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.1/socket.io.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.24.2.min.js"></script>
</head>
<body>
    <h1>3D LED Visualizer</h1>
    <div id="plot" style="width: 100%; height: 600px;"></div>

 <script>
    const socket = io(); // Connect to the WebSocket server

    let coords = [];
    let plotData;

    // Initialize the 3D plot with LED coordinates
    socket.on("init_coords", (data) => {
        coords = data.coords;
        const x = coords.map(c => c[0]);
        const y = coords.map(c => c[1]);
        const z = coords.map(c => c[2]);

        plotData = {
            x: x,
            y: y,
            z: z,
            mode: "markers",
            marker: {
                size: 5,
                color: "rgb(0, 0, 0)", // Default color
                colorscale: "Viridis", // Optional colorscale for dynamic updates
                showscale: false
            },
            type: "scatter3d"
        };

        // Create the initial plot
        Plotly.newPlot("plot", [plotData], {
            margin: { t: 0 }, // Remove top margin
            scene: {
                xaxis: { title: "X Axis" },
                yaxis: { title: "Y Axis" },
                zaxis: { title: "Z Axis" },
            },
        });
    });

    // Update the LED colors dynamically without resetting interaction tools
    socket.on("update_leds", (data) => {
        if (plotData) {
            const newColors = data.colors.map(color =>
                `rgb(${Math.floor(color[0] * 255)}, ${Math.floor(color[1] * 255)}, ${Math.floor(color[2] * 255)})`
            );

            // Update the plot with new colors, keeping all interactions intact
            plotData.marker.color = newColors;
            Plotly.react("plot", [plotData], {
                margin: { t: 0 }, // Keep the layout
                scene: {
                    xaxis: { title: "X Axis" },
                    yaxis: { title: "Y Axis" },
                    zaxis: { title: "Z Axis" },
                },
            });
        }
    });
</script>

</body>
</html>
